const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/sql-wasm-C4NFpN6Q.js","assets/react-vendor-Cxiu5o9j.js"])))=>i.map(i=>d[i]);
import{D as b}from"./ai-vendor-sMRHZoBv.js";const p="modulepreload",y=function(d){return"/"+d},h={},D=function(t,e,n){let a=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),s=r?.nonce||r?.getAttribute("nonce");a=Promise.allSettled(e.map(o=>{if(o=y(o),o in h)return;h[o]=!0;const l=o.endsWith(".css"),w=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${w}`))return;const c=document.createElement("link");if(c.rel=l?"stylesheet":p,l||(c.as="script"),c.crossOrigin="",c.href=o,s&&c.setAttribute("nonce",s),document.head.appendChild(c),l)return new Promise((f,m)=>{c.addEventListener("load",f),c.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${o}`)))})}))}function i(r){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=r,window.dispatchEvent(s),!s.defaultPrevented)throw r}return a.then(r=>{for(const s of r||[])s.status==="rejected"&&i(s.reason);return t().catch(i)})};class x{constructor(){Object.defineProperty(this,"db",{enumerable:!0,configurable:!0,writable:!0,value:null})}async init(){if(this.db)return;const e=await(await D(()=>import("./sql-wasm-C4NFpN6Q.js").then(a=>a.s),__vite__mapDeps([0,1]))).default({locateFile:a=>`https://sql.js.org/dist/${a}`}),n=await this.loadFromIndexedDB();n?this.db=new e.Database(n):(this.db=new e.Database,await this.initSchema())}async exec(t,e=[]){if(!this.db)throw new Error("Database not initialized");const n=this.db.exec(t,e);return await this.saveToIndexedDB(),n}async run(t,e=[]){if(!this.db)throw new Error("Database not initialized");this.db.run(t,e),await this.saveToIndexedDB()}async get(t,e=[]){return(await this.all(t,e))[0]}async all(t,e=[]){if(!this.db)throw new Error("Database not initialized");const n=this.db.exec(t,e);if(n.length===0)return[];const a=n[0].columns;return n[0].values.map(r=>{const s={};return a.forEach((o,l)=>{s[o]=r[l]}),s})}async close(){this.db&&(await this.saveToIndexedDB(),this.db.close(),this.db=null)}async initSchema(){const e=await(await fetch("/schema.sql")).text();await this.exec(e)}async saveToIndexedDB(){if(!this.db)return;const t=this.db.export(),e=await this.openIndexedDB();return new Promise((n,a)=>{const s=e.transaction(["databases"],"readwrite").objectStore("databases").put({name:b,data:t});s.onsuccess=()=>n(),s.onerror=()=>a(s.error)})}async loadFromIndexedDB(){try{const t=await this.openIndexedDB();return new Promise((e,n)=>{const r=t.transaction(["databases"],"readonly").objectStore("databases").get(b);r.onsuccess=()=>{const s=r.result;e(s?.data||null)},r.onerror=()=>n(r.error)})}catch{return null}}openIndexedDB(){return new Promise((t,e)=>{const n=indexedDB.open("PeerLearningDB",1);n.onerror=()=>e(n.error),n.onsuccess=()=>t(n.result),n.onupgradeneeded=a=>{const i=a.target.result;i.objectStoreNames.contains("databases")||i.createObjectStore("databases",{keyPath:"name"})}})}}class E{constructor(){Object.defineProperty(this,"db",{enumerable:!0,configurable:!0,writable:!0,value:null})}async init(){console.warn("Mobile database client not fully implemented")}async exec(t,e=[]){if(!this.db)throw new Error("Database not initialized");return[]}async run(t,e=[]){if(!this.db)throw new Error("Database not initialized")}async get(t,e=[]){if(!this.db)throw new Error("Database not initialized")}async all(t,e=[]){if(!this.db)throw new Error("Database not initialized");return[]}async close(){this.db&&(this.db=null)}}function v(){return typeof window<"u"&&!("expo"in globalThis)?new x:new E}let u=null;async function _(){return u||(u=v(),await u.init()),u}export{_ as g};
